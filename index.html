<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesic Instinct - Your Data-Driven Horoscope</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const BayesicInstinct = () => {
            const [belief, setBelief] = useState('');
            const [step, setStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [questions, setQuestions] = useState([]);
            const [answers, setAnswers] = useState([]);
            const [result, setResult] = useState(null);

            const handleAnalyze = async () => {
                if (!belief.trim()) return;
                setLoading(true);
                
                try {
                    const response = await fetch('https://hook.eu2.make.com/iqhhvjbiqj72796bl96gnlqgfhzajudy', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ belief, step: 'analyze' })
                    });
                    
                    const data = await response.json();
                    setQuestions(data.questions || []);
                    setAnswers(new Array(data.questions?.length || 0).fill(''));
                    setStep(2);
                } catch (error) {
                    console.error('Webhook error:', error);
                    alert('Something went wrong. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleCalculate = async () => {
                if (answers.some(a => !a.trim())) {
                    alert('Please answer all questions!');
                    return;
                }
                
                setLoading(true);
                
                try {
                    const response = await fetch('https://hook.eu2.make.com/a5xiec7iyrshy7c0tpdij0u4d2wqiyzh', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ belief, questions, answers, step: 'calculate' })
                    });
                    
                    const data = await response.json();
                    setResult(data);
                    setStep(3);
                } catch (error) {
                    console.error('Calculation error:', error);
                    alert('Calculation failed. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const reset = () => {
                setBelief('');
                setStep(1);
                setQuestions([]);
                setAnswers([]);
                setResult(null);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 to-indigo-900 text-white p-6">
                    <div className="max-w-2xl mx-auto">
                        {/* Other components remain unchanged */}

                        {/* Step 3: Results */}
                        {step === 3 && result && (
                            <div className="bg-purple-800/30 p-6 rounded-lg backdrop-blur-sm">
                                <h2 className="text-2xl font-bold mb-6">Here's what the data says...</h2>
                                <div className="bg-indigo-900/40 p-4 rounded-lg mb-6">
                                    <h3 className="text-lg font-bold mb-4 text-center">Bayesian Calculation Breakdown</h3>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm border-collapse">
                                            <tbody>
                                                <tr className="bg-blue-900/30">
                                                    <td className="p-3 font-bold text-blue-100" colSpan="4">PRIOR PROBABILITY</td>
                                                </tr>
                                                <tr className="border-b border-purple-500/20">
                                                    <td className="p-3 text-purple-100">Initial estimate of how likely it is that your belief is true</td>
                                                    <td className="p-3 text-center font-mono text-yellow-400 text-lg">X</td>
                                                    <td className="p-3 text-center text-green-400 font-bold text-lg">{result.prior_probability || 'N/A'}%</td>
                                                    <td className="p-3 text-blue-400 text-xs">
                                                        {result.prior_source || 'Research baseline'}
                                                        {result.prior_statistic && <div className="mt-1 text-blue-300">{result.prior_statistic}</div>}
                                                        {result.prior_reason && <div className="mt-1 text-purple-300 italic">{result.prior_reason}</div>}
                                                    </td>
                                                </tr>

                                                <tr className="bg-purple-900/30">
                                                    <td className="p-3 font-bold text-purple-100" colSpan="4">A NEW EVENT OCCURS: YOUR RESPONSES ARE ANALYZED</td>
                                                </tr>
                                                <tr className="border-b border-purple-500/20">
                                                    <td className="p-3 text-purple-100">Probability of your responses appearing, conditional on your belief being true</td>
                                                    <td className="p-3 text-center font-mono text-yellow-400 text-lg">Y</td>
                                                    <td className="p-3 text-center text-green-400 font-bold text-lg">{result.evidence_true || 0}%</td>
                                                    <td className="p-3 text-purple-300 text-xs">
                                                        Based on sentiment analysis of your answers
                                                        {result.evidence_true_reason && <div className="mt-1 text-purple-300 italic">{result.evidence_true_reason}</div>}
                                                    </td>
                                                </tr>
                                                <tr className="border-b border-purple-500/20">
                                                    <td className="p-3 text-purple-100">Probability of your responses appearing if your belief is NOT true</td>
                                                    <td className="p-3 text-center font-mono text-yellow-400 text-lg">Z</td>
                                                    <td className="p-3 text-center text-red-400 font-bold text-lg">{result.evidence_false || 0}%</td>
                                                    <td className="p-3 text-purple-300 text-xs">
                                                        Conditional probability analysis
                                                        {result.evidence_false_reason && <div className="mt-1 text-purple-300 italic">{result.evidence_false_reason}</div>}
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BayesicInstinct />);
    </script>
</body>
</html>
